<template name="autotable">
  {{#with context}}
    {{>UI.contentBlock reactiveConfig}}
    <table class="table {{tableStyle}}">
      <thead>
        <tr>
          {{#each fields}}
            <th><span class="field-table-heading" data-sort-key="{{key}}">
                {{label}} &nbsp;
                {{#if isSortKey}} {{#if isAscending}}
                    <span class="glyphicon glyphicon-chevron-down"></span>
                    {{else}}
                    <span class="glyphicon glyphicon-chevron-up"></span>
                {{/if}}{{/if}}
            </span></th>
          {{/each}}
        </tr>
      </thead>
      <tbody>
        {{#each records}}
          <tr>
            {{#each ../fields}}
              <td>
                {{#if tpl}}
                  {{#with ..}}
                    {{> ../tpl}}
                  {{/with}}
                  {{else}}
                    {{getField ..}}
                  {{/if}}
              </td>
            {{/each}}
          </tr>
          {{#if ../updateRows}}
            <tr style="display: none;">
              <td colspan={{fieldCount ..}}>
                <div style="margin-left: 10%; margin-right: 10%">
                  {{> quickForm id=updateFormId doc=this collection=../collection type="update" template="bootstrap3-horizontal" label-class="col-sm-3" input-col-class="col-sm-9"}}
                </div>
              </td>
            </tr>
          {{/if}}
        {{/each}}
        {{#if addButton}}
          <tr>
            <td colspan={{fieldCount}}>
              <button class="btn add">Add...</button>

              <div class="modal fade" role="dialog">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Create new</h4>
                    </div>
                    <div class="modal-body">
                      {{> quickForm id=modalId collection=../collection type="insert" template="bootstrap3-horizontal" label-class="col-sm-3" input-col-class="col-sm-9"}}
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        {{/if}}
      </tbody>
    </table>
  {{/with}}
</template>

<template name="atColumn">
  {{#with customTemplateRenderContext .. ../..}}
    {{! > renderCustomTemplate}}
  {{/with}}
</template>

<template name="atDefaultColumn">
  {{value}}
</template>

<template name="atEditColumn">
  <div class="field-area">
    <div class="inline-edit">
      {{value}}
    </div>
    <div class="inline-edit-icon pull-right">
      <button type="button" class="btn btn-xs btn-link" data-action="show-edit-field">
        <span class="glyphicon glyphicon-pencil"></span>
      </button>
    </div>
  </div>

  <div class="field-edit-area">
    {{#if allowedValues}}
      <select name="edit-field">
        {{#each allowedValues}}
          <option value="{{this}}">{{this}}</option>
        {{/each}}
      </select>
      {{else}}
      <input type="text" name="edit-field">
    {{/if}}
    <button type="button" class="btn btn-xs btn-primary" data-action="save-field" data-field="{{field}}">Save</button>
  </div>
</template>
